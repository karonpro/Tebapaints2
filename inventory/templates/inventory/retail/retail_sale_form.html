<!-- templates/retail/retail_sale_form.html -->
<form method="post" id="retailSaleForm">
    {% csrf_token %}
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                {{ form.product.label_tag }}
                {{ form.product }}
                {{ form.product.errors }}
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                {{ form.location.label_tag }}
                {{ form.location }}
                {{ form.location.errors }}
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                {{ form.unit_price.label_tag }}
                {{ form.unit_price }}
                {{ form.unit_price.errors }}
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                {{ form.current_stock.label_tag }}
                {{ form.current_stock }}
                <small class="form-text text-muted">Current available stock</small>
            </div>
        </div>
    </div>
    
    <div class="form-group">
        {{ form.amount_given.label_tag }}
        {{ form.amount_given }}
        {{ form.amount_given.errors }}
        <small class="form-text text-muted">{{ form.amount_given.help_text }}</small>
    </div>
    
    <button type="submit" class="btn btn-primary">Process Sale</button>
</form>

<script>
function updateStock() {
    const productId = document.getElementById('id_product').value;
    const locationId = document.getElementById('id_location').value;
    
    if (productId && locationId) {
        // You would typically make an AJAX call here to get current stock
        fetch(`/api/stock/${productId}/${locationId}/`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('id_current_stock').value = data.quantity;
            });
    }
}

// Initial call and event listeners
document.addEventListener('DOMContentLoaded', function() {
    updateStock();
});
</script>